{% extends "mailservices/base.html" %}
{% block title %}История отправки{% endblock %}
{%  include 'mailservices/includes/inc_menu.html' %}


{% block content %}
<div class="container my-5">
  <h2>История попыток отправки</h2>

  {% if attempts %}
    <table class="table table-striped table-hover">
      <thead class="table-light">
        <tr>
          <th>Рассылка</th>
          <th>Дата и время</th>
          <th>Статус</th>
          <th>Ответ сервера</th>
          {% if request.user.is_superuser or request.user.is_moderator %}
            <th>Владелец</th>
          {% endif %}
        </tr>
      </thead>
      <tbody>
        {% for attempt in attempts %}
          <tr>
            <td><a href="{% url 'mailservices:sending_detail' attempt.mailing.id %}">{{ attempt.mailing }}</a></td>
            <td>{{ attempt.attempt_datetime|date:"d.m.Y H:i:s" }}</td>
            <td>
              <span class="badge {% if attempt.status == 'success' %}bg-success{% else %}bg-danger{% endif %}">
                {{ attempt.get_status_display }}
              </span>
            </td>
            <td>
              <small class="text-muted">{{ attempt.server_response|default:"—" }}</small>
            </td>
            {% if request.user.is_superuser or request.user.is_moderator %}
              <td>{{ attempt.mailing.owner.email }}</td>
            {% endif %}
          </tr>
        {% endfor %}
      </tbody>
    </table>

    {% include "mailservices/includes/pagination.html" %}
  {% else %}
    <div class="alert alert-info">Нет записей о попытках отправки.</div>
  {% endif %}
</div>
{% endblock %}
